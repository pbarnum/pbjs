!function(e){if(!e||!e.pbjs)throw new Error("PBJS does not exist!");var t;pbjs.box=function(e){if(pbjs.isArray(t))return this.create(e);var i={boxes:[],current:null,nextId:function(){var e=1;if(this.boxes.length<=0)return e;for(var t in this.boxes)this.boxes[t].id>e&&(e=this.boxes[e].id);return e+1},getBoxById:function(e){for(var t in this.boxes)if(this.boxes[t].id==e)return this.boxes[t];return null},setCurrent:function(e){this.boxes.length<=0&&(this.current=null);var t=this.getBoxById(e);t?this.current=t.id:this.current=this.boxes[this.boxes.length-1].id},addBox:function(e){ContentBox.prototype.created=!0,this.boxes.push(e),this.setCurrent(e.id),document.body.appendChild(e.element)},removeBox:function(e){var t=this.getBoxById(e);t.element.parentNode.removeChild(t.element),this.setCurrent(),this.boxes.splice(this.boxes.indexOf(t),1)},findZIndex:function(){var e=100,t=document.getElementsByTagName("*");if(!t.length)return e;for(var i=0;i<t.length;++i){var n=parseInt(t[i].style.zIndex);n>e&&(e=n)}return e+1}};return this.getManager=function(){return i},this.undefined="undefined",this.CLASSES={CONTAINER:"cBox-container",TITLE_BAR:"cBox-titleBar",BODY:"cBox-body",TITLE:"cBox-title",BUTTON:"cBox-button",CLOSE:"cBox-close",RESIZE:"cBox-resize",ACTION_BAR:"cBox-actionBar"},e&&this.create(e),this},pbjs.box.prototype.create=function(t){var i=this,n=this.getManager().boxes;t=t||{},t.isMovable=typeof t.isMovable!==this.undefined?t.isMovable:!0,t.isScalable=typeof t.isScalable!==this.undefined?t.isScalable:!0,t.buttons=t.buttons||{},t.height=t.height||480,t.width=t.width||680,t.title=t.title||"Content Box",t.body=t.body||"",this.callbacks={},this.callbacks.beforeCreate=t.beforeCreate,this.callbacks.afterCreate=t.afterCreate,this.callbacks.beforeClose=t.beforeClose,"function"==typeof this.callbacks.beforeCreate&&this.callbacks.beforeCreate(n);var s={};s.id=this.getManager().nextId(),s.height=t.height,s.width=t.width,s.element=createElement("div",{id:"cBox-"+s.id,"class":this.CLASSES.CONTAINER,style:["z-index:"+this.getManager().findZIndex(),"height:"+t.height+"px","width:"+t.width+"px","top:"+(e.innerHeight/2-t.height/2)+"px","left:"+(e.innerWidth/2-t.width/2)+"px"]}),s.element.addEventListener("mousedown",function(e){var t=i.getCurrent();if(t){var n=t.element.style.zIndex;t.element.style.zIndex=s.element.style.zIndex,s.element.style.zIndex=n}i.getManager().setCurrent(s.id)},!0);var a=s.element,r=createElement("div",{id:this.CLASSES.TITLE_BAR+"-"+s.id,"class":this.CLASSES.TITLE_BAR});r.innerHTML='<span class="'+this.CLASSES.TITLE+'">'+t.title+"</span>";var o={},d={},l={};t.isMovable&&(o=function(e){return r.dataset.zIndex=a.style.zIndex,r.dataset.diffTop=a.offsetTop-e.clientY,r.dataset.diffLeft=a.offsetLeft-e.clientX,r.dataset.active="true",a.style.zIndex=i.getManager().findZIndex(),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1},d=function(t){if("true"!==r.dataset.active)return 0;var i=(a.offsetTop,a.offsetLeft,a.offsetTop+a.offsetHeight,a.offsetLeft+a.offsetWidth,t.clientY+Number(r.dataset.diffTop)),n=t.clientX+Number(r.dataset.diffLeft);0>i&&(i=0),i+a.offsetHeight>e.innerHeight&&(i=e.innerHeight-a.offsetHeight),0>n&&(n=0),n+a.offsetWidth>e.innerWidth&&(n=e.innerWidth-a.offsetWidth),a.style.top=i+"px",a.style.left=n+"px"},l=function(e){a.style.zIndex=Number(r.dataset.zIndex),clearDataset(r)}),r.addEventListener("mousedown",o),e.addEventListener("mousemove",d),e.addEventListener("mouseup",l),s.element.appendChild(r);var h=createElement("div",{id:this.CLASSES.BODY+"-"+s.id,"class":this.CLASSES.BODY});"function"==typeof t.body?t.body(h):h.innerHTML=t.body,s.element.appendChild(h);var c=createElement("a",{"class":this.CLASSES.BUTTON+" "+this.CLASSES.CLOSE,href:"javascript:void(0);"});c.addEventListener("click",function(e){i.close()},!1),c.innerHTML="Close";var f=createElement("div",{id:this.CLASSES.ACTION_BAR+"-"+s.id,"class":this.CLASSES.ACTION_BAR}),u=document.createElement("ul"),p=document.createElement("li");p.appendChild(c),u.appendChild(p);for(button in t.buttons){var b=t.buttons[button];b.href=b.href||"javascript:void(0);";var p=document.createElement("li"),x="";b["class"]!=this.undefined&&(b["class"].constructor===Array&&(b["class"]=b["class"].join(" ")),x=" "+b["class"]);var v=createElement("a",{"class":this.CLASSES.BUTTON+x,href:b.href});v.innerHTML=b.text,p.appendChild(v),u.appendChild(p)}if(f.appendChild(u),s.element.appendChild(f),t.isScalable){var g=createElement("div",{id:this.CLASSES.RESIZE+"-"+s.id,"class":this.CLASSES.RESIZE});g.addEventListener("mousedown",function(e){return g.dataset.oHeight=a.offsetHeight,g.dataset.oWidth=a.offsetWidth,g.dataset.initY=e.clientY,g.dataset.initX=e.clientX,g.dataset.active="true",e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}),e.addEventListener("mousemove",function(e){if("true"!==g.dataset.active)return 0;var t=(a.offsetHeight,a.offsetWidth,e.clientY-g.dataset.initY+Number(g.dataset.oHeight)),i=e.clientX-g.dataset.initX+Number(g.dataset.oWidth);100>t&&(t=100),200>i&&(i=200),a.style.height=t+"px",a.style.width=i+"px"}),e.addEventListener("mouseup",function(e){clearDataset(g)}),s.element.appendChild(g)}return this.getManager().addBox(s),"function"==typeof this.callbacks.afterCreate&&this.callbacks.afterCreate(s),s},pbjs.box.prototype.getCurrent=function(){return this.getManager().getBoxById(this.getManager().current)},pbjs.box.prototype.close=function(){var e=this.getCurrent();"function"==typeof this.callbacks.beforeClose&&this.callbacks.beforeClose(e),e&&this.getManager().removeBox(e.id)}}(window);