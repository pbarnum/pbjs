!function(e){if(!e||!e.pbjs)throw new Error("PBJS does not exist!");var t;pbjs.box=function(e){return t.constructor===Array?this.create(e):(t=[],this.undefined="undefined",this.CLASSES={CONTAINER:"cBox-container",TITLE_BAR:"cBox-titleBar",BODY:"cBox-body",TITLE:"cBox-title",BUTTON:"cBox-button",CLOSE:"cBox-close",RESIZE:"cBox-resize",ACTION_BAR:"cBox-actionBar"},e&&this.create(e),this)},pbjs.box.prototype.create=function(t){var i=this,a=this.getManager().boxes;t=t||{},t.isMovable=typeof t.isMovable!==this.undefined?t.isMovable:!0,t.isScalable=typeof t.isScalable!==this.undefined?t.isScalable:!0,t.buttons=t.buttons||{},t.height=t.height||480,t.width=t.width||680,t.title=t.title||"Content Box",t.body=t.body||"",this.callbacks={},this.callbacks.beforeCreate=t.beforeCreate,this.callbacks.afterCreate=t.afterCreate,this.callbacks.beforeClose=t.beforeClose,"function"==typeof this.callbacks.beforeCreate&&this.callbacks.beforeCreate(a);var n={};n.id=this.getManager().nextId(),n.height=t.height,n.width=t.width,n.element=createElement("div",{id:"cBox-"+n.id,"class":this.CLASSES.CONTAINER,style:["z-index:"+this.getManager().findZIndex(),"height:"+t.height+"px","width:"+t.width+"px","top:"+(e.innerHeight/2-t.height/2)+"px","left:"+(e.innerWidth/2-t.width/2)+"px"]}),n.element.addEventListener("mousedown",function(e){var t=i.getCurrent();if(t){var a=t.element.style.zIndex;t.element.style.zIndex=n.element.style.zIndex,n.element.style.zIndex=a}i.getManager().setCurrent(n.id)},!0);var s=n.element,o=createElement("div",{id:this.CLASSES.TITLE_BAR+"-"+n.id,"class":this.CLASSES.TITLE_BAR});o.innerHTML='<span class="'+this.CLASSES.TITLE+'">'+t.title+"</span>";var r={},d={},l={};t.isMovable&&(r=function(e){return o.dataset.zIndex=s.style.zIndex,o.dataset.diffTop=s.offsetTop-e.clientY,o.dataset.diffLeft=s.offsetLeft-e.clientX,o.dataset.active="true",s.style.zIndex=i.getManager().findZIndex(),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1},d=function(t){if("true"!==o.dataset.active)return 0;var i=(s.offsetTop,s.offsetLeft,s.offsetTop+s.offsetHeight,s.offsetLeft+s.offsetWidth,t.clientY+Number(o.dataset.diffTop)),a=t.clientX+Number(o.dataset.diffLeft);0>i&&(i=0),i+s.offsetHeight>e.innerHeight&&(i=e.innerHeight-s.offsetHeight),0>a&&(a=0),a+s.offsetWidth>e.innerWidth&&(a=e.innerWidth-s.offsetWidth),s.style.top=i+"px",s.style.left=a+"px"},l=function(e){s.style.zIndex=Number(o.dataset.zIndex),clearDataset(o)}),o.addEventListener("mousedown",r),e.addEventListener("mousemove",d),e.addEventListener("mouseup",l),n.element.appendChild(o);var c=createElement("div",{id:this.CLASSES.BODY+"-"+n.id,"class":this.CLASSES.BODY});"function"==typeof t.body?t.body(c):c.innerHTML=t.body,n.element.appendChild(c);var f=createElement("a",{"class":this.CLASSES.BUTTON+" "+this.CLASSES.CLOSE,href:"javascript:void(0);"});f.addEventListener("click",function(e){i.close()},!1),f.innerHTML="Close";var h=createElement("div",{id:this.CLASSES.ACTION_BAR+"-"+n.id,"class":this.CLASSES.ACTION_BAR}),u=document.createElement("ul"),p=document.createElement("li");p.appendChild(f),u.appendChild(p);for(button in t.buttons){var b=t.buttons[button];b.href=b.href||"javascript:void(0);";var p=document.createElement("li"),S="";b["class"]!=this.undefined&&(b["class"].constructor===Array&&(b["class"]=b["class"].join(" ")),S=" "+b["class"]);var v=createElement("a",{"class":this.CLASSES.BUTTON+S,href:b.href});v.innerHTML=b.text,p.appendChild(v),u.appendChild(p)}if(h.appendChild(u),n.element.appendChild(h),t.isScalable){var C=createElement("div",{id:this.CLASSES.RESIZE+"-"+n.id,"class":this.CLASSES.RESIZE});C.addEventListener("mousedown",function(e){return C.dataset.oHeight=s.offsetHeight,C.dataset.oWidth=s.offsetWidth,C.dataset.initY=e.clientY,C.dataset.initX=e.clientX,C.dataset.active="true",e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}),e.addEventListener("mousemove",function(e){if("true"!==C.dataset.active)return 0;var t=(s.offsetHeight,s.offsetWidth,e.clientY-C.dataset.initY+Number(C.dataset.oHeight)),i=e.clientX-C.dataset.initX+Number(C.dataset.oWidth);100>t&&(t=100),200>i&&(i=200),s.style.height=t+"px",s.style.width=i+"px"}),e.addEventListener("mouseup",function(e){clearDataset(C)}),n.element.appendChild(C)}this.getManager().addBox(n),"function"==typeof this.callbacks.afterCreate&&this.callbacks.afterCreate(n)},pbjs.box.prototype.getCurrent=function(){return this.getManager().getBoxById(this.getManager().current)},pbjs.box.prototype.close=function(){var e=this.getCurrent();"function"==typeof this.callbacks.beforeClose&&this.callbacks.beforeClose(e),e&&this.getManager().removeBox(e.id)}}(window);